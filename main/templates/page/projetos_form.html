<!DOCTYPE html>
{% load static %}
<html>
<head>
  <title>Criar Projeto</title>
  <link rel="stylesheet" href="{% static 'css/projetos_form.css' %}">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    .mes-campo {
      display: none;
    }

    select#id_codigo_produto {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: white;
      }
    .mes-grid{
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 8px;
      margin-bottom: 8px;
    }
    .mes-grid .mes-item{
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }
    .mes-grid input[inputmode="decimal"]{
      width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  {% if edit %}
    <h1>Editar Projeto</h1>
  {% else %}
    <h1>Criar Projeto</h1>
  {% endif %}

  <form method="post">
    {% csrf_token %}
    <p>
      <label for="id_nome_projeto">Projeto / Atividade</label>
      {{ form.nome_projeto }}
    </p>

    <p>
      <label for="id_justificativa">Objetivo / Justificativa</label>
      {{ form.justificativa }}
    </p>

    <p>
      <label for="id_nome_projeto">Tipo de Conta</label>
      {{ form.tipo_conta }}
    </p>
    <p>
      <label for="id_codigo_produto">Conta Contábil (para DGA)</label>
      {{ form.codigo_produto }}
    </p>

    <h3>Gastos Mensais por Conta</h3>

    <p style="color: #666;">Selecione as contas acima e preencha os valores mensais para cada conta. Cada conta terá seu próprio conjunto de 12 meses.</p>

    <div id="contas-container"></div>

    <p>
      <label for="id_e_recorrente">É Recorrente?</label>
      {{ form.e_recorrente }}
    </p>

    <p>
      <label for="id_obrigacao_legal">Obrigação Legal?</label>
      {{ form.obrigacao_legal }}
    </p>

    <p style="margin-top: 20px; font-weight: bold;">
      <label for="id_valor_total">Total:</label>
      {{ form.valor_total }}
    </p>

    <br>
    {% if edit %}
      <button type="submit">Atualizar Projeto</button>
    {% else %}
      <button type="submit">Salvar Projeto</button>
    {% endif %}
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>
  <!-- Dados iniciais para pré-preenchimento (se em modo edição) -->
  <script>
    const CONTAS_INITIAL = {{ contas_data|default:'[]'|safe }};
  </script>
  <!-- Script externo da lógica do formulário -->
  <script src="{% static 'js/projetos_form.js' %}"></script>
</body>
</html>


